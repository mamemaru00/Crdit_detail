# バックエンドテスト仕様書

## 1. CSVファイル処理テスト

### 1.1 ファイル読み込みテスト
- 正常なCSVファイルの読み込み確認
- 不正なフォーマットのエラーハンドリング
- 空ファイルの処理確認
- 大容量ファイル（10MB以上）の処理性能確認

### 1.2 データ解析テスト
- 利用日の日付フォーマット解析（複数形式対応）
- 店舗名の文字列処理（全角/半角、特殊文字）
- 金額のパース処理（カンマ区切り、マイナス値）

## 2. Google Sheets API連携テスト

### 2.1 認証テスト
- サービスアカウント認証の成功確認
- 認証失敗時のエラーハンドリング
- アクセス権限不足の検知

### 2.2 書き込みテスト
- 指定セル（B～V列）への正確な書き込み
- 月別シート選択の正確性（1月～12月）
- 既存データの上書き防止確認
- バッチ書き込みの整合性確認

### 2.3 エラーリカバリー
- API呼び出し失敗時のリトライ処理
- タイムアウト時の適切な処理
- レート制限対応

## 3. マッピング機能テスト

### 3.1 パターンマッチングテスト
- 完全一致の正確性確認
- 前方一致の動作確認
- 部分一致の動作確認
- 優先順位の適用確認

### 3.2 CRUD操作テスト
- マッピング登録の成功確認
- 更新処理の整合性
- 削除処理の安全性
- 重複登録の防止

### 3.3 データ永続化テスト
- JSONファイル保存の確認
- データ読み込みの整合性
- ファイル破損時の対応

## 4. 集計処理テスト

### 4.1 計算ロジックテスト
- 月別集計の正確性
- カテゴリ別集計の正確性
- 合計金額の計算確認
- 処理件数のカウント確認

### 4.2 未登録店舗検知テスト
- マッピング未登録店舗の抽出
- 重複排除処理
- 金額合計の正確性

## 5. 統合テスト

### 5.1 エンドツーエンドテスト
- CSV取込→集計→Sheets書き込みの一連フロー
- エラー発生時のロールバック確認
- ログ出力の完全性

### 5.2 性能テスト
- 1000件データの処理時間測定（目標：30秒以内）
- 同時実行時の動作確認
- メモリ使用量の監視
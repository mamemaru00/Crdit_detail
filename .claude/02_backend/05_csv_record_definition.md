# CSVレコード定義書

## 概要
CSVファイルから抽出した明細データの一時データ構造。メモリ上で管理し、処理完了後は破棄。

## データ構造

| フィールド名 | 型 | 必須 | 説明 | 例 |
|------------|-----|------|------|-----|
| date | date | ○ | 利用日 | 2025-08-15 |
| year | integer | ○ | 年 | 2025 |
| month | integer | ○ | 月番号 | 8 |
| month_str | string | ○ | 月表示 | "2025年8月" |
| store_name | string | ○ | 店舗名 | "ユシンヤカマタテン" |
| amount | integer | ○ | 金額 | 5780 |
| user | string | ○ | 利用者区分 | "本人" |
| payment_method | string | ○ | 支払方法 | "１回" |
| note | string | - | 備考 | "Apple Pay利用分" |
| category | string | ○ | 判定カテゴリ | "外食費" |
| column | string | ○ | 振り分け列 | "C" |
| is_registered | boolean | ○ | 登録済みフラグ | true |

## データ変換フロー

### 入力（CSV生データ）
```
250815,本人,ユシンヤカマタテン,１回,,,5780,,
```

### 出力（構造化データ）
```python
{
    "date": "2025-08-15",
    "year": 2025,
    "month": 8,
    "month_str": "2025年8月",
    "store_name": "ユシンヤカマタテン",
    "amount": 5780,
    "user": "本人",
    "payment_method": "１回",
    "note": "",
    "category": "外食費",
    "column": "C",
    "is_registered": true
}
```

## 処理ステップ

1. **CSV読み込み**: Shift_JIS → UTF-8変換
2. **日付変換**: YYMMDD → YYYY-MM-DD
3. **明細抽出**: 6桁数字で始まる行を抽出
4. **カテゴリ判定**: マッピングテーブルと照合
5. **列番号決定**: カテゴリから列番号を取得
6. **フラグ設定**: 登録済み/未登録を判定

## データ保持期間
- **処理中**: メモリ上で保持
- **処理完了後**: 即座に破棄
- **ログ出力**: 必要に応じてファイル保存

## 集計用途
- 月別・カテゴリ別の金額集計
- 未登録店舗の抽出
- スプレッドシート更新データの生成

## 注意事項
- データベースには保存しない
- 個人情報を含むため処理後は確実に削除
- ログ出力時は店舗名のみ記録
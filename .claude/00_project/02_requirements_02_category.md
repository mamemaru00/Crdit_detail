# 機能要件詳細 02 - カテゴリ判定・マッピング管理機能

## 3. カテゴリ自動判定機能【優先度:高】

### 機能概要
店舗名からカテゴリを自動判定し、対応するスプレッドシート列を特定する。

### 詳細仕様
**マッピングテーブル構造**
- JSON形式で管理（config/mapping.json）
- 各エントリーに店舗名パターン、カテゴリ、列番号を定義
- 優先度設定による判定順序の制御

**判定アルゴリズム**
1. **完全一致判定**：店舗名が完全に一致
2. **前方一致判定**：店舗名の先頭部分が一致
3. **部分一致判定**：店舗名の一部が一致（contains）
4. **キーワード一致**：特定キーワードの存在確認

**判定例**
```
店舗名「ユシンヤカマタテン」
→ "ユシンヤ" を含む → 外食費（C列）

店舗名「ＡＭＡＺＯＮ．ＣＯ．ＪＰ」
→ "AMAZON" を含む → 日用品費（D列）

店舗名「スイカ　ケイタイケツサイ」
→ "スイカ" を含む → 交通費（N列）
```

**未登録店舗の処理**
- デフォルト列（B列「支払額」）に自動振り分け
- 未登録店舗リストを生成
- ユーザーに確認画面を表示
- 今回のみ適用 or 登録して適用を選択可能

**カテゴリと列の対応**
- B列：支払額（デフォルト）
- C列：外食費
- D列：日用品費
- E列：車両代
- F列：家電
- G列：娯楽費
- H列：交際・化粧費
- I列：旅行費
- J列：実家代
- K列：水道代
- L列：電気代・ガス代
- M列：携帯費
- N列：交通費
- O列：医療費
- P列：個人年金
- Q～V列：その他カテゴリ

### 入出力
**入力**: 店舗名、マッピングテーブル
**出力**: カテゴリ名、列番号（B～V）、マッチング結果

## 4. マッピング管理機能【優先度:中】

### 機能概要
店舗名とカテゴリのマッピングを管理する。

### 詳細仕様
**基本操作**
- マッピングの追加、編集、削除
- 検索・フィルター機能
- 一覧表示（店舗名、カテゴリ、列番号）

**データ管理**
- JSON形式でのインポート・エクスポート
- CSV形式でのインポート・エクスポート
- バックアップ機能

**未登録店舗管理**
- 未登録店舗の一覧表示
- 店舗ごとの利用履歴表示
- 利用金額の表示

**一括登録機能**
- 複数の未登録店舗を一度に登録
- CSV/JSONファイルからの一括インポート
- デフォルトカテゴリの一括設定

### 画面構成
- マッピング一覧テーブル
- 新規追加フォーム
- 編集・削除ボタン
- インポート・エクスポートボタン

### 入出力
**入力**: 店舗名パターン、カテゴリ選択、列番号
**出力**: 更新されたマッピングテーブル
